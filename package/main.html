<html><head><title>Duet WebGL - AP</title><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes"/><script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script><link href="elements.html" rel="import"/><style is="custom-style" include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning"></style><link rel="stylesheet" async="async" href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300|Poiret+One|Roboto"/><script src="bower_components/phaser/build/phaser.min.js"></script></head><body class="fullbleed"><style>body,head,html{margin:0;padding:0;border:0;background:#1D1D1D;overflow:hidden}h1,h2,h3{font-family:"Poiret One";font-weight:200}canvas{height:100%;width:100%}</style><style is="custom-style">.nav-bar,paper-toolbar{width:100%;left:0;position:absolute}.creator,.nav-bar,paper-toolbar{position:absolute}paper-toolbar{background-color:transparent;top:0}paper-toolbar[nw]{top:2em}.scrubber{-webkit-app-region:drag;cursor:move;background-image:-webkit-repeating-radial-gradient(center center,rgba(0,0,0,.2),rgba(0,0,0,.2) 1px,transparent 1px,transparent 100%);background-image:-moz-repeating-radial-gradient(center center,rgba(0,0,0,.2),rgba(0,0,0,.2) 1px,transparent 1px,transparent 100%);background-image:-ms-repeating-radial-gradient(center center,rgba(0,0,0,.2),rgba(0,0,0,.2) 1px,transparent 1px,transparent 100%);background-image:repeating-radial-gradient(center center,rgba(0,0,0,.2),rgba(0,0,0,.2) 1px,transparent 1px,transparent 100%);-webkit-background-size:3px 3px;-moz-background-size:3px 3px;background-size:3px 3px}.nav-bar{background:rgba(255,255,255,.08);height:2em;top:0;text-align:right}.nav-bar .btn{color:#fff;width:4em;height:100%;text-align:center;display:inline-block;transition:background-color .25s}.nav-bar .btn>*{height:100%;padding:6px}.nav-bar .close.btn:hover{background:#c62828}.nav-bar .min.btn:hover{background:rgba(255,255,255,.21)}.creator{bottom:0;font-family:Poiret One;color:rgba(255,255,255,.11);font-size:.8em;right:5px;transition:color .25s}.creator:hover{color:rgba(255,255,255,.41)}.creator a{text-decoration:none;color:inherit}</style><template id="app" is="dom-bind"><audio src="[[track]]" loop="loop" autoplay="autoplay"></audio><paper-toolbar nw$="[[isNodeWebkit]]"><h1>Duet</h1><div class="flex"></div><h3>Score: [[round(score)]]</h3></paper-toolbar><header class="nav-bar layout horizontal" hidden$="[[!isNodeWebkit]]"><div class="flex scrubber"></div><div class="btn min"><paper-icon-button icon="remove" on-tap="minimize"></paper-icon-button></div><div class="btn close"><paper-icon-button icon="close" on-tap="exit"></paper-icon-button></div></header></template><footer class="creator"><a class="AP" href="http://linkedin.com/in/apoorvverma" target="_blank">Created by Apoorv Verma [AP]</a></footer><script>"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}Array.prototype.make=function(t){return Array.apply(0,Array(t)).map(function(t,e){return e})},Number.prototype.rangeRandom=function(t,e){return Math.random()*(e-t)+t},String.prototype.titleCase=function(){for(var t=this.toLowerCase().split(" "),e=0;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1);return t.join(" ")};var t=document.querySelector("#app"),game,bs,wl;navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate||function(t){},t.vibrate=function(t){return navigator.vibrate(t)},t.isNodeWebkit="undefined"!=typeof require,t.w_spin=[],t.sprinkleBack=[],t.score=0,t.level=1,t.track="public/theme.ogg",t.round=function(t){return Math.round(t)},t.minimize=function(e){return t.nw?t.nw.gui.Window.get().minimize():alert("No can do minimizing!")},t.exit=function(e){return t.nw?t.nw.gui.App.quit():window.close()},t.sleep=function(t){return new Promise(function(e){return setTimeout(e,t)})},t.distanceFormula=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},t.isNodeWebkit?(t.getLevel=function(t){return require("../levels/"+t+".json")},t.nw={gui:require("nw.gui")}):t.getLevel=function(t){return 1==t?{walls:[{type:"left"},{type:"center"},{type:"left"},{type:"left"},{type:"right"}],track:"/public/lv1.ogg"}:2==t?{walls:[{type:"left"},{type:"center"},{type:"spin"},{type:"center"},{type:"spin",dir:1},{type:"left"},{type:"right"},{type:"left"},{type:"center"}],track:"/public/lv1.ogg"}:3==t?{walls:[{type:"narrow"},{type:"center"},{type:"spin"},{type:"spin",dir:1},{type:"center"},{type:"center"},{type:"narrow"},{type:"narrow"},{type:"left"},{type:"right"}],track:"/public/lv1.ogg"}:{walls:[{type:"narrow"},{type:"center"},{type:"spin",dir:1},{type:"spin"},{type:"spin"},{type:"spin",dir:1},{type:"spin",dir:1},{type:"spin"},{type:"narrow"},{type:"right"}],track:"/public/lv2.ogg"}},t.setScore=function(e){clearInterval(t.curInt);var n={in:(e-t.score)/30,f:e},i=n.in<0;t.curInt=setInterval(function(e){t.score=t.score+n.in,(i?t.score<=n.f:t.score>=n.f)&&(t.score=n.f,clearInterval(t.curInt))},30)},t.gameSetup=function(t){},t.gameSetup.prototype={preload:function(){var t=.875*game.height,e=game.world.centerX,n=150,i=.22,a=function(t,e){var n=game.add.bitmapData(t,e);return n.ctx.beginPath(),n.ctx.rect(0,0,t,e),n.ctx.fillStyle="#ffffff",n.ctx.closePath(),n.ctx.fill(),n},r=function(t,e){e=e||10;var n=game.add.bitmapData(2*e,2*e);return n.ctx.fillStyle=t,n.ctx.beginPath(),n.ctx.arc(e,e,e,0,2*Math.PI,!1),n.ctx.closePath(),n.ctx.fill(),n},o=game.add.graphics(e,t);o.lineStyle(1,8816262),o.alpha=.5,this.disk=o.arc(0,0,e*i,0,2*Math.PI,!1),this.config={moved:0,SpinFunc:function(t,e,n){return((t||-1)*game.speed*.98*(e-n)+90)%360},ball_velocity:3.327484130859375,WALL_H:30,PAD:{basic:n,spin:1.3*n},W_OFFSET:e,H_OFFSET:t,BALL_RAD:i,MakeRect:a,MakeCircle:r}},keyBindings:function(){this.cursors=game.input.keyboard.createCursorKeys();var t=Phaser.Keyboard,e=game.input.keyboard.addKey(t.LEFT),n=game.input.keyboard.addKey(t.RIGHT);game.input.keyboard.addKey(t.r).onDown.add(this.resetGame,this),e.onDown.add(this.spinLeft,this),n.onDown.add(this.spinRight,this),e.onUp.add(this.spinLeftDone,this),n.onUp.add(this.spinRightDone,this)},spinLeft:function(){bs.lPressed=!!(bs.rotate="left")},spinRight:function(){bs.rPressed=!!(bs.rotate="right")},spinRightDone:function(){bs.rPressed=!1,bs.rotate=bs.lPressed&&"left"},spinLeftDone:function(){bs.lPressed=!1,bs.rotate=bs.rPressed&&"right"},create:function(){var e=this;t.gameSleep=function(t){return new Promise(function(n){return game.time.events.add(t,function(t){return n(e)},e)})},game.scale.pageAlignHorizontally=game.scale.pageAlignVertically=!0,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.speed=4,this.keyBindings();var n=game.physics;n.startSystem(Phaser.Physics.P2JS),n.p2.setImpactEvents(!0),n.p2.restitution=.8,this.BallCG=n.p2.createCollisionGroup(),this.WallCG=n.p2.createCollisionGroup();var i=this.config;this.balls=bs=game.add.group(),this.walls=wl=game.add.group(),this.particlesGroup=game.add.group(),[wl,bs,this.particlesGroup].forEach(function(t){t.enableBody=!0,t.physicsBodyType=Phaser.Physics.P2JS}),this.ballX=bs.create(i.W_OFFSET*(1-i.BALL_RAD),i.H_OFFSET,i.MakeCircle("#FF0000",11)),this.ballY=bs.create(i.W_OFFSET*(1+i.BALL_RAD),i.H_OFFSET,i.MakeCircle("#2196F3",11)),this.ballX.tint=16711680,this.ballY.tint=2201331,this.makeWalls(t.getLevel(t.level),this);var a=function(t){return[250,Phaser.Easing.Linear.None,!0,0,t,!0]};wl.children.forEach(function(t,e){var n;return(n=game.add.tween(t.scale)).to.apply(n,[{x:1.05,y:1.15}].concat(_toConsumableArray(a(250*(e+1)))))}),[this.ballX,this.ballY].forEach(function(t){t.body.setCircle(t.width/2),t.body.fixedRotation=!0,t.body.setCollisionGroup(e.BallCG),t.body.collides([e.WallCG,e.BallCG]),t.anchor.set(.5,.5),t.body.kinematic=!0,t.body.createGroupCallback(e.WallCG,e.ballSplat,e)}),app.c=this,t.wlPos=wl.children.map(function(t){return{x:t.position.x,y:t.position.y,deg:t.body.angle}}),wl.setAll("body.velocity.y",0),game.camera.follow(this.center)},makeWalls:function(e,n){var i=this.config,a=1.05*i.W_OFFSET,r=22;t.track=e.track;var o=0,s=function(t,e,n){var s=function(t,e){return i.MakeRect(t,e)},l=function(t,e){return{left:0+e/2,right:game.width-e/2,center:i.W_OFFSET,spin:i.W_OFFSET,narrow:0+e/2}[t]},c={left:[a,i.WALL_H],right:[a,i.WALL_H],center:[.15*i.W_OFFSET,.15*i.W_OFFSET],spin:[.45*i.W_OFFSET,i.WALL_H],narrow:[i.W_OFFSET-3*r,i.WALL_H]},p=c[e],u=i.H_OFFSET/4;if(p){var h=p[0],d=p[1],f=s(h,d);"spin"==e&&(o+=i.PAD.spin-i.PAD.basic);var g=t.create(l(e,h),u-o,f);g.body.setRectangle(h,d);var y=[g];if("narrow"==e){var m=(s(h,d),t.create(l("right",h),u-o,f));m.body.setRectangle(h,d),y.push(m)}return o+=i.PAD["spin"==e?e:"basic"],y}};e.walls.forEach(function(e,a){var r=s(wl,e.type,a);r&&r.forEach(function(a){if(a.body.setCollisionGroup(n.WallCG),a.body.collides([n.WallCG,n.BallCG]),"spin"==e.type){var r=(i.H_OFFSET-(a.position.y+a.width/2))/i.ball_velocity;a.body.angle=i.SpinFunc(0,r),t.w_spin.push([{dir:e.dir,iters:r},a])}})})},update:function(){var e=this,n=this.config,i=game.input.activePointer,a=n.moved/200;if(game.complete||wl.children.forEach(function(t){return t.body.moveDown(200)}),game.complete||(n.moved+=200),i.isDown?(n.cursor=!0,bs.rotate=i.positionDown.x<n.W_OFFSET?"left":"right"):n.cursor&&(n.cursor=!1,bs.rotate=""),t.sprinkleBack.forEach(function(e,n){e()&&delete t.sprinkleBack[n]}),t.sprinkleBack=t.sprinkleBack.filter(function(t){return t}),!game.complete&&bs.rotate&&this.rotateBalls(),t.w_spin.length&&t.w_spin.forEach(function(t){t[1].body.fixedRotation=!1,t[1].body.angle=n.SpinFunc(t[0].dir,a,t[0].iters)}),wl.children.slice(-1)[0].position.y>n.H_OFFSET+200&&!game.complete){game.complete=!0;var r=game.add.text(0,0,"You have completed the Level",{font:"40px 'Poiret One'",fill:"#FFFFFF",align:"center"});r.position.set(Math.floor(n.W_OFFSET-r.width/2),Math.floor(game.height/2-r.height/2)),t.setScore(t.score+50),t.gameSleep(1500).then(function(t){return e.LevelUp(e)})}},rotateBalls:function(){var t=this,e=this.config;bs.children.forEach(function(n){var i=t.ballX.body.angle+game.speed*("right"==bs.rotate?1:"left"==bs.rotate?-1:0),a=e.W_OFFSET*e.BALL_RAD,r=n.body,o=Math.PI/180,s=n==t.ballY,l=s?-1:1;n.body.angle=i+(s?180:0),r.x=e.W_OFFSET-a*Math.cos(i*o)*l,r.y=e.H_OFFSET-a*Math.sin(i*o)*l})},resetGame:function(){game.state.start("PlayGame",!0,!0)},resetAlignment:function(e){var n=this;return new Promise(function(i){t.sprinkleBack.push(function(t){var a=e.ballX;return Math.abs(a.body.angle%360)<10?(bs.rotate="",a.body.angle=0,n.rotateBalls(),i(),!0):(bs.rotate="left",void n.rotateBalls())})})},resetWalls:function(e){var n=e.config,i=(n.moved,function(t){return wl.children.forEach(function(e){var n=e.body;n.setZeroVelocity(),n.angularVelocity=0,n.kinematic=t,n.fixedRotation=t,n.angle=0})});return new Promise(function(e){i(!0),t.sprinkleBack.push(function(t){if(!n.moved)return e(),i(!1),!0;var a=n.moved<100?n.moved:Math.max(Math.pow(n.moved,.7),200);n.moved-=a,wl.children.forEach(function(t){t.body.moveUp(a)})})})},reviveBalls:function(){var t=this,e=[],n=this.sprinkleRevive.bind(this),i=t.config;return new Promise(function(a){t.ballX.alive||e.push(n(t.ballX,{x:i.W_OFFSET*(1-i.BALL_RAD),y:i.H_OFFSET})),t.ballY.alive||e.push(n(t.ballY,{x:i.W_OFFSET*(1+i.BALL_RAD),y:i.H_OFFSET})),Promise.all(e).then(a)})},LevelUp:function(e){var n=this;e.config;this.resetAlignment(e).then(this.reviveBalls.bind(this)).then(function(e){t.level++,t.w_spin=[],game.complete=!1,n.resetGame.bind(n)()})},ballSplat:function(e,n){var i=this,a=this;this.sprinkleDeath(e.sprite),t.vibrate([25,25,25]),n.sprite.tint=e.sprite.tint,game.complete=!0,Promise.all([this.resetAlignment(a),this.resetWalls(a)]).then(this.reviveBalls.bind(this)).then(function(e){t.w_spin=[],game.complete=!1,i.resetGame.bind(i)()})},sprinkleRevive:function(e,n){var i=this;return new Promise(function(a){var r=i.config,o="#"+Phaser.Color.componentToHex(e.tint),s=i.particlesGroup,l=[],c=[-999,0];[].make(25).forEach(function(i){var a=s.getFirstExists(!1)||s.create(0,0,r.MakeCircle(o,(0).rangeRandom(1,4))),p=a.body,u={x:r.W_OFFSET+r.W_OFFSET*(0).rangeRandom(-.75,.75),y:(0).rangeRandom(-300,0)},h=!1;u.y>c[0]&&(c=[u.y,i],h=!0),a.reset(u.x,u.y),a.alpha=.8,a.tint=e.tint,p.damping=.03,p.mass=.01,p.velocity.x=0,p.velocity.y=0,a.anchor.set(.5,.5),l.push(new Promise(function(e){var i=function(i){var r=a.position,o=Math.atan2(r.y-n.y,r.x-n.x),s=(h?75:0)+400*Math.sqrt(Math.sqrt((r.y-n.y)/(u.y-n.y))),l=400*Math.sqrt(Math.sqrt((r.x-n.x)/(u.x-n.x))),c=t.distanceFormula(r,n);if(p.rotation=o+game.math.degToRad(90),p.velocity.x=-Math.cos(o)*l,p.velocity.y=-Math.sin(o)*s,isNaN(c)||c<1)return p.velocity.x=p.velocity.y=0,a.kill(),e(),!0};t.sprinkleBack.push(i)}))}),l[c[1]].then(function(t){e.reset(n.x,n.y),e.scale.set(.1,.1),game.add.tween(e.scale).from({x:.1,y:.1}).to({x:1,y:1},500,Phaser.Easing.Linear.None,!0,0,1,!1)}),Promise.all(l).then(function(t){return console.info("Promise fulfilled",e==i.ballX?"X":"Y")}).then(a)})},sprinkleDeath:function(t){var e=this.config,n=t.position,i="#"+Phaser.Color.componentToHex(t.tint),a=this.particlesGroup;[].make(50).forEach(function(r){var o=a.getFirstExists(!1)||a.create(0,0,e.MakeCircle(i,(0).rangeRandom(1,4))),s=o.body;o.reset(n.x,n.y),o.tint=t.tint,s.velocity.x=(0).rangeRandom(-100,100),s.force.y=100+(0).rangeRandom(-10,150),s.mass=.01,s.fixedRotation=!0,s.collideWorldBounds=!1,o.anchor.set(.5,.5),o.lifespan=3e3,o.alpha=.8}),t.kill()}},window.onload=function(){game=t.g=new Phaser.Game(640,960,Phaser.AUTO,"",void 0,!0),game.state.add("PlayGame",t.gameSetup),game.state.start("PlayGame")};</script></body></html>